# 新しいステップの実装開始

## 🎯 このコマンドの目的
新しいfeatureブランチを作成し、次のステップの実装を開始する

## 📋 前提条件
- [ ] Git初期設定が完了している（`01-初期設定.md`）
- [ ] `ブランチ管理表.md` で次に実装すべきステップを確認済み
- [ ] developブランチが最新状態

## 🚀 実行手順

### ステップ1: 現在の状態を確認

```bash
# 現在のブランチを確認
git branch --show-current

# 変更が残っていないか確認
git status
```

**期待される出力:**
```
On branch develop
nothing to commit, working tree clean
```

**⚠️ 変更が残っている場合:**
```bash
# 変更を一時退避
git stash

# または、変更をコミット
git add .
git commit -m "作業中の変更を保存"
```

---

### ステップ2: developブランチを最新にする

```bash
# developブランチに切り替え（まだの場合）
git checkout develop

# リモートから最新の変更を取得
git pull origin develop
```

---

### ステップ3: 実装するステップを確認

**`ブランチ管理表.md` を確認してください。**

次に実装すべきステップ（例）:
- ✅ ステップ1-3: 実装済み
- 🔄 **ステップ4: 台本生成** ← 次はこれ
- ⏳ ステップ5: 音声生成
- ⏳ ステップ6: 字幕生成
- ...

---

### ステップ4: 新しいfeatureブランチを作成

```bash
# ブランチ名のフォーマット: feature/step-XX-brief-description
# 例: ステップ4の場合

git checkout -b feature/step-04-script-generation

# ブランチが作成されたことを確認
git branch --show-current
```

**期待される出力:**
```
feature/step-04-script-generation
```

**ブランチ命名規則:**
```
feature/step-02-sheets-integration       (ステップ2)
feature/step-03-info-collection          (ステップ3)
feature/step-04-script-generation        (ステップ4)
feature/step-05-audio-generation         (ステップ5)
feature/step-06-subtitle-generation      (ステップ6)
feature/step-07-video-generation         (ステップ7)
feature/step-08-metadata-generation      (ステップ8)
feature/step-09-thumbnail-generation     (ステップ9)
feature/step-10-drive-upload             (ステップ10)
feature/step-11-results-recording        (ステップ11)
feature/step-12-completion-notification  (ステップ12)
```

---

### ステップ5: 実装作業を開始

**AIアシスタントに質問:**
```
「ステップ4の台本生成を実装してください。
必須メソッド一覧を参照してください。」
```

**実装するファイル（例: ステップ4の場合）:**
1. `modules/claude_client.py`
   - `generate_dialogue_script()` メソッドを追加
   
2. `main.py`
   - `step_04_generate_script()` メソッドを追加
   - `run()` メソッドに `await self.step_04_generate_script()` を追加

---

### ステップ6: 実装の確認

```bash
# 変更されたファイルを確認
git status

# 変更内容を確認
git diff modules/claude_client.py
git diff main.py
```

---

### ステップ7: コミット（小さな単位で）

```bash
# メソッド実装をコミット
git add modules/claude_client.py
git commit -m "feat: Claude APIで台本生成メソッドを実装

- generate_dialogue_script()メソッドを追加
- 対談形式（Aさん・Bさん）の台本生成
- エラーハンドリングとログ出力を実装
- 15-20分相当の台本を生成

参照: .cursor/rules/必須メソッド一覧.mdc"

# main.pyへの追加をコミット
git add main.py
git commit -m "feat: main.pyにstep_04_generate_script()を追加

- PodcastPipelineクラスにstep_04メソッドを追加
- timer_contextでパフォーマンス計測
- エラーハンドリングとSheets進捗更新を実装"
```

**コミットメッセージのフォーマット:**
```
<type>: <subject>

<body>

<footer>
```

**Type の種類:**
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント
- `refactor`: リファクタリング
- `test`: テスト
- `chore`: その他

---

### ステップ8: run()メソッドの更新

```bash
# run()メソッドに新しいステップを追加した場合
git add main.py
git commit -m "feat: run()メソッドにstep_04呼び出しを追加"
```

---

### ステップ9: テスト実行（オプション）

```bash
# Pytestでテスト実行
python -m pytest tests/ -v

# または特定のステップをテスト
python -c "
import asyncio
from main import PodcastPipeline

async def test():
    pipeline = PodcastPipeline()
    await pipeline.step_01_initialize()
    await pipeline.step_02_create_sheet_row()
    await pipeline.step_03_collect_information()
    await pipeline.step_04_generate_script()
    print('✅ ステップ4まで正常に動作しました')

asyncio.run(test())
"
```

---

### ステップ10: リモートにプッシュ（バックアップ）

```bash
# 現在のfeatureブランチをGitHubにプッシュ
git push -u origin feature/step-04-script-generation
```

**期待される出力:**
```
* [new branch]      feature/step-04-script-generation -> feature/step-04-script-generation
Branch 'feature/step-04-script-generation' set up to track remote branch 'feature/step-04-script-generation' from 'origin'.
```

---

## ✅ 完了確認

```bash
# 現在のブランチ
git branch --show-current

# コミット履歴
git log --oneline -5

# リモートブランチ
git branch -r | grep feature
```

**期待される状態:**
- ✅ featureブランチにいる
- ✅ 実装がコミット済み
- ✅ GitHubにプッシュ済み

---

## 🎯 次のステップ

実装が完了したら：
1. `03-実装完了とマージ.md` - developにマージ
2. `ブランチ管理表.md` を更新 - ステップの状態を更新

作業を中断する場合：
1. 変更をコミット
2. GitHubにプッシュ
3. 次回は同じfeatureブランチで続行

---

## 🆘 トラブルシューティング

### エラー: branch already exists
```bash
# 既存のブランチに切り替える
git checkout feature/step-04-script-generation

# または、削除して再作成
git branch -D feature/step-04-script-generation
git checkout -b feature/step-04-script-generation
```

### 間違ったブランチで作業してしまった
```bash
# 変更を一時退避
git stash

# 正しいブランチに切り替え
git checkout feature/step-04-script-generation

# 変更を適用
git stash pop
```

### コミットメッセージを間違えた
```bash
# 直前のコミットメッセージを修正
git commit --amend -m "正しいメッセージ"

# プッシュ済みの場合は強制プッシュ（⚠️ 注意）
git push -f origin feature/step-04-script-generation
```

### ファイルを追加し忘れた
```bash
# 追加のファイルをステージング
git add forgotten_file.py

# 直前のコミットに追加
git commit --amend --no-edit
```

---

## 💡 ベストプラクティス

### コミット単位
- ✅ 1つのメソッド追加 = 1コミット
- ✅ main.pyへの追加 = 1コミット
- ✅ ドキュメント更新 = 1コミット
- ❌ 複数の機能を1コミットにまとめない

### コミット頻度
- 小さく頻繁にコミット
- 動作する状態でコミット
- GitHubに定期的にプッシュ（バックアップ）

### ブランチの寿命
- 1ステップ = 1featureブランチ
- 実装完了後すぐにマージ
- 長期間残さない

---

## 📝 コミットメッセージ例

### 良い例 ✅
```bash
git commit -m "feat: Claude APIで台本生成メソッドを実装

- generate_dialogue_script()メソッドを追加
- 対談形式の台本生成ロジック
- エラーハンドリング実装
- 15-20分相当の台本生成"
```

### 悪い例 ❌
```bash
git commit -m "update"
git commit -m "fix"
git commit -m "いろいろ修正"
```

### テンプレート
```bash
git commit -m "feat: [機能名]を実装

- 詳細1
- 詳細2
- 詳細3

関連: [issue番号や参照ドキュメント]"
```

