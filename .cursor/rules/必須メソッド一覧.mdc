# å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§ - å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å®Ÿè£…ãŒå¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã¨ãã®ã‚·ã‚°ãƒãƒãƒ£ã‚’å®šç¾©ã—ã¾ã™ã€‚
AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ã€æ­£ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰åã¨ã‚·ã‚°ãƒãƒãƒ£ã§å®Ÿè£…ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

## âœ… å®Ÿè£…æ¸ˆã¿ã‚¯ãƒ©ã‚¹ï¼ˆæ—¢å­˜ï¼‰

### config/settings.py
```python
class Settings(BaseSettings):
    # å…¨ã¦ã®ç’°å¢ƒå¤‰æ•°ã‚’ç®¡ç†
    # pydantic BaseSettings ã‚’ç¶™æ‰¿
    pass
```

### utils/logger.py
```python
def setup_logger(log_level: str, log_file: str = None) -> logging.Logger
def get_logger(name: str) -> logging.Logger
```

### utils/error_handler.py
```python
class ErrorHandler:
    def __init__(self, logger: logging.Logger)
    def handle_error(self, error: Exception, context: Dict[str, Any]) -> Dict[str, Any]
    def handle_api_error(self, error: Exception, api_name: str) -> Dict[str, Any]
    def get_error_summary(self) -> Dict[str, Any]

class RetryHandler:
    def __init__(self, logger: logging.Logger, max_retries: int = 3, delay: float = 1.0)
    async def retry_async(self, func, *args, **kwargs)
    def retry_sync(self, func, *args, **kwargs)
```

### utils/timer.py
```python
class Timer:
    def __init__(self, name: str, logger: logging.Logger)
    def start(self) -> None
    def stop(self) -> None
    def get_duration(self) -> float

def timer_context(name: str, logger: logging.Logger)
```

---

## ğŸ“ è¦å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰

### modules/sheets_manager.py

#### å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰1: create_new_row
```python
async def create_new_row(self, row_data: Dict[str, Any]) -> str:
    """
    Google Sheetsã«æ–°è¦è¡Œã‚’ä½œæˆ
    
    Args:
        row_data: è¡Œã«æ›¸ãè¾¼ã‚€ãƒ‡ãƒ¼ã‚¿ï¼ˆDictå½¢å¼ï¼‰
                  ä¾‹: {"å®Ÿè¡Œæ—¥æ™‚": "2024-01-01 10:00:00", "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹": "å‡¦ç†ä¸­"}
    
    Returns:
        str: ä½œæˆã•ã‚ŒãŸè¡Œã®IDï¼ˆè¡Œç•ªå·ã®æ–‡å­—åˆ—ï¼‰
    
    ä½¿ç”¨å ´æ‰€: main.py step_02_create_sheet_row()
    """
    try:
        spreadsheet = self.client.open_by_key(self.settings.GOOGLE_SHEETS_ID)
        worksheet = spreadsheet.sheet1
        
        # åˆ—ã®ãƒ˜ãƒƒãƒ€ãƒ¼é †åºã«åˆã‚ã›ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
        row_values = list(row_data.values())
        worksheet.append_row(row_values)
        
        # è¿½åŠ ã•ã‚ŒãŸè¡Œç•ªå·ã‚’å–å¾—
        row_id = len(worksheet.get_all_values())
        
        logger.info(f"æ–°è¦è¡Œã‚’ä½œæˆã—ã¾ã—ãŸ: è¡Œ{row_id}")
        return str(row_id)
    except Exception as e:
        logger.error(f"æ–°è¦è¡Œä½œæˆã«å¤±æ•—: {e}")
        raise
```

#### å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰2: update_row
```python
async def update_row(self, row_id: str, data: Dict[str, Any]) -> None:
    """
    Google Sheetsã®æŒ‡å®šè¡Œã‚’æ›´æ–°
    
    Args:
        row_id: æ›´æ–°ã™ã‚‹è¡Œã®IDï¼ˆè¡Œç•ªå·ã®æ–‡å­—åˆ—ï¼‰
        data: æ›´æ–°ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆDictå½¢å¼ï¼‰
              ä¾‹: {"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹": "å®Œäº†", "é€²æ—": "å®Œäº†"}
    
    Returns:
        None
    
    ä½¿ç”¨å ´æ‰€: 
        - main.py step_03_collect_information() (é€²æ—æ›´æ–°)
        - main.py step_11_record_results() (æœ€çµ‚çµæœè¨˜éŒ²)
    """
    try:
        spreadsheet = self.client.open_by_key(self.settings.GOOGLE_SHEETS_ID)
        worksheet = spreadsheet.sheet1
        
        # ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’å–å¾—
        headers = worksheet.row_values(1)
        
        # å„ãƒ‡ãƒ¼ã‚¿ã‚’è©²å½“ã™ã‚‹åˆ—ã«æ›´æ–°
        for key, value in data.items():
            if key in headers:
                col_index = headers.index(key) + 1  # 1-indexed
                cell = worksheet.cell(int(row_id), col_index)
                worksheet.update_cell(int(row_id), col_index, value)
        
        logger.info(f"è¡Œ{row_id}ã‚’æ›´æ–°ã—ã¾ã—ãŸ")
    except Exception as e:
        logger.error(f"è¡Œæ›´æ–°ã«å¤±æ•—: {e}")
        raise
```

---

### modules/claude_client.py

#### å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰1: collect_topics_with_web_search
```python
async def collect_topics_with_web_search(self) -> Dict[str, Any]:
    """
    Claude APIã®web_searchæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦æƒ…å ±åé›†
    
    æƒ…å ±æº:
        - Indie Hackers (https://www.indiehackers.com/)
        - Product Hunt (https://www.producthunt.com/)
        - Hacker News Show HN (https://news.ycombinator.com/show)
    
    Returns:
        Dict[str, Any]: åé›†ã—ãŸãƒˆãƒ”ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
        {
            "topics": [
                {
                    "title": str,
                    "summary": str,
                    "url": str,
                    "category": str,
                    "interesting_points": str
                },
                ...
            ],
            "collected_at": str,
            "total_count": int
        }
    
    ä½¿ç”¨å ´æ‰€: main.py step_03_collect_information()
    ç›®æ¨™ä»¶æ•°: 3-5ä»¶
    ç›®æ¨™æ™‚é–“: 2-3åˆ†
    """
    try:
        prompt = """
        ä»¥ä¸‹ã®æƒ…å ±æºã‹ã‚‰ã€æœ€æ–°ã®å€‹äººé–‹ç™ºãƒ»AIé–¢é€£ã®èˆˆå‘³æ·±ã„ãƒˆãƒ”ãƒƒã‚¯ã‚’3-5ä»¶åé›†ã—ã¦ãã ã•ã„ï¼š
        
        1. Indie Hackers (https://www.indiehackers.com/)
        2. Product Hunt (https://www.producthunt.com/)
        3. Hacker News Show HN (https://news.ycombinator.com/show)
        
        å„ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã‚ã¦ãã ã•ã„ï¼š
        - ã‚¿ã‚¤ãƒˆãƒ«
        - æ¦‚è¦ï¼ˆ200æ–‡å­—ç¨‹åº¦ï¼‰
        - URL
        - ã‚«ãƒ†ã‚´ãƒªï¼ˆå€‹äººé–‹ç™º/AI/MicroSaaSç­‰ï¼‰
        - èˆˆå‘³æ·±ã„ãƒã‚¤ãƒ³ãƒˆ
        
        JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§è¿”ã—ã¦ãã ã•ã„ã€‚
        """
        
        response = self.client.messages.create(
            model="claude-3-sonnet-20240229",
            max_tokens=4000,
            temperature=0.7,
            tools=[{"type": "web_search"}],  # âš ï¸ web_searchæœ‰åŠ¹åŒ–
            messages=[{"role": "user", "content": prompt}]
        )
        
        # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è§£æ
        topics_data = self._parse_topics_response(response)
        
        logger.info(f"æƒ…å ±åé›†å®Œäº†: {len(topics_data.get('topics', []))}ä»¶")
        return topics_data
    except Exception as e:
        logger.error(f"æƒ…å ±åé›†ã«å¤±æ•—: {e}")
        raise
```

#### å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰2: generate_dialogue_script
```python
async def generate_dialogue_script(self, topics_data: Dict[str, Any]) -> Dict[str, Any]:
    """
    å¯¾è«‡å½¢å¼ã®å°æœ¬ã‚’ç”Ÿæˆ
    
    Args:
        topics_data: step_03ã§åé›†ã—ãŸãƒˆãƒ”ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
    
    Returns:
        Dict[str, Any]: ç”Ÿæˆã•ã‚ŒãŸå°æœ¬
        {
            "title": str,                    # ã‚¿ã‚¤ãƒˆãƒ«
            "full_script": str,             # å®Œå…¨ãªå°æœ¬ãƒ†ã‚­ã‚¹ãƒˆ
            "sections": [                   # ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†å‰²
                {
                    "section_name": str,
                    "content": str,
                    "speaker": str,         # "A" or "B"
                    "estimated_duration": int
                },
                ...
            ],
            "estimated_duration": int,      # æ¨å®šæ™‚é–“ï¼ˆç§’ï¼‰
            "word_count": int               # æ–‡å­—æ•°
        }
    
    ä½¿ç”¨å ´æ‰€: main.py step_04_generate_script()
    ç›®æ¨™æ™‚é–“: 2-3åˆ†
    å°æœ¬é•·ã•: 15-20åˆ†ç›¸å½“
    
    ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š:
        - Aã•ã‚“ï¼ˆæ¥½è¦³æ´¾ï¼‰: æ–°ã—ã„ã‚‚ã®ã«èˆˆå‘³æ´¥ã€…ã€å®Ÿè£…ã®å¯èƒ½æ€§ã‚’è€ƒãˆã‚‹
        - Bã•ã‚“ï¼ˆæ‡ç–‘æ´¾ï¼‰: ç¾å®Ÿçš„ãƒ»æ‰¹åˆ¤çš„è¦–ç‚¹ã€ãƒ“ã‚¸ãƒã‚¹é¢ã‚’å•ã†
    
    æ§‹æˆ:
        1. ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚° (1åˆ†)
        2. ãƒˆãƒ”ãƒƒã‚¯1 (3-4åˆ†)
        3. ãƒˆãƒ”ãƒƒã‚¯2 (3-4åˆ†)
        4. ãƒˆãƒ”ãƒƒã‚¯3 (3-4åˆ†)
        5. [è¿½åŠ ãƒˆãƒ”ãƒƒã‚¯]ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        6. ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚° (1-2åˆ†)
    """
    try:
        prompt = f"""
        ä»¥ä¸‹ã®ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦ã€å¯¾è«‡å½¢å¼ã®ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆå°æœ¬ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
        
        ãƒˆãƒ”ãƒƒã‚¯:
        {json.dumps(topics_data, ensure_ascii=False, indent=2)}
        
        ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:
        - Aã•ã‚“ï¼ˆæ¥½è¦³æ´¾ï¼‰: æ–°ã—ã„ã‚‚ã®ã«èˆˆå‘³æ´¥ã€…ã€å®Ÿè£…ã®å¯èƒ½æ€§ã‚’è€ƒãˆã‚‹
        - Bã•ã‚“ï¼ˆæ‡ç–‘æ´¾ï¼‰: ç¾å®Ÿçš„ãƒ»æ‰¹åˆ¤çš„è¦–ç‚¹ã€ãƒ“ã‚¸ãƒã‚¹é¢ã‚’å•ã†
        
        æ§‹æˆï¼ˆ15-20åˆ†ï¼‰:
        1. ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚° (1åˆ†) - è»½ã„æŒ¨æ‹¶ã¨ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒç´¹ä»‹
        2. ãƒˆãƒ”ãƒƒã‚¯1 (3-4åˆ†) - è©³ã—ãæ˜ã‚Šä¸‹ã’ã‚‹
        3. ãƒˆãƒ”ãƒƒã‚¯2 (3-4åˆ†) - è©³ã—ãæ˜ã‚Šä¸‹ã’ã‚‹
        4. ãƒˆãƒ”ãƒƒã‚¯3 (3-4åˆ†) - è©³ã—ãæ˜ã‚Šä¸‹ã’ã‚‹
        5. ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚° (1-2åˆ†) - ã¾ã¨ã‚ã¨æ¬¡å›äºˆå‘Š
        
        è¦ä»¶:
        - è‡ªç„¶ãªä¼šè©±å½¢å¼ï¼ˆæ›ã‘åˆã„ï¼‰
        - èãæ‰‹ãŒèˆˆå‘³ã‚’æŒã¦ã‚‹å†…å®¹
        - å…·ä½“çš„ãªä¾‹ã‚„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’å«ã‚ã‚‹
        - è©±è€…ã‚’æ˜è¨˜: [Aã•ã‚“] [Bã•ã‚“]
        """
        
        response = self.client.messages.create(
            model="claude-3-sonnet-20240229",
            max_tokens=4000,
            temperature=0.7,
            messages=[{"role": "user", "content": prompt}]
        )
        
        # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è§£æ
        script_content = self._parse_script_response(response)
        
        logger.info(f"å°æœ¬ç”Ÿæˆå®Œäº†: {script_content.get('word_count', 0)}æ–‡å­—")
        return script_content
    except Exception as e:
        logger.error(f"å°æœ¬ç”Ÿæˆã«å¤±æ•—: {e}")
        raise
```

---

### modules/audio_generator.py

#### å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰1: generate_audio_parallel
```python
async def generate_audio_parallel(self, script_content: Dict[str, Any]) -> str:
    """
    å°æœ¬ã‹ã‚‰éŸ³å£°ã‚’ä¸¦åˆ—ç”Ÿæˆï¼ˆé«˜é€ŸåŒ–ï¼‰
    
    Args:
        script_content: step_04ã§ç”Ÿæˆã—ãŸå°æœ¬ãƒ‡ãƒ¼ã‚¿
    
    Returns:
        str: çµåˆã•ã‚ŒãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
    
    ä½¿ç”¨å ´æ‰€: main.py step_05_generate_audio()
    ç›®æ¨™æ™‚é–“: 5-10åˆ†
    
    å‡¦ç†ãƒ•ãƒ­ãƒ¼:
        1. å°æœ¬ã‚’è©±è€…ã”ã¨ãƒ»5000æ–‡å­—ä»¥å†…ã«ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²
        2. å„ãƒãƒ£ãƒ³ã‚¯ã‚’ä¸¦åˆ—å‡¦ç†ï¼ˆ3ä¸¦åˆ—æ¨å¥¨ï¼‰
        3. Google Cloud TTSã§éŸ³å£°ç”Ÿæˆ
        4. ç”Ÿæˆã•ã‚ŒãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ
    
    éŸ³å£°è¨­å®š:
        - Aã•ã‚“: ja-JP-Neural2-C (ãƒ”ãƒƒãƒ: 0)
        - Bã•ã‚“: ja-JP-Neural2-D (ãƒ”ãƒƒãƒ: -2)
    """
    try:
        from google.cloud import texttospeech
        from pydub import AudioSegment
        import asyncio
        
        full_script = script_content.get("full_script", "")
        
        # å°æœ¬ã‚’è©±è€…ã”ã¨ã«åˆ†å‰²
        chunks = self._split_script_by_speaker(full_script)
        
        # ä¸¦åˆ—å‡¦ç†ã§éŸ³å£°ç”Ÿæˆ
        tasks = []
        for i, chunk in enumerate(chunks):
            task = self._generate_single_audio(
                chunk["text"],
                chunk["speaker"],
                f"temp/audio_chunk_{i}.mp3"
            )
            tasks.append(task)
        
        audio_files = await asyncio.gather(*tasks)
        
        # éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ
        final_audio_path = self._merge_audio_files(audio_files)
        
        logger.info(f"éŸ³å£°ç”Ÿæˆå®Œäº†: {final_audio_path}")
        return final_audio_path
    except Exception as e:
        logger.error(f"éŸ³å£°ç”Ÿæˆã«å¤±æ•—: {e}")
        raise
```

#### å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰2: generate_subtitles
```python
async def generate_subtitles(
    self, 
    audio_path: str, 
    script_content: Dict[str, Any]
) -> Dict[str, Any]:
    """
    éŸ³å£°ã‹ã‚‰å­—å¹•ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆï¼ˆSTT + ãƒãƒƒãƒãƒ³ã‚°ï¼‰
    
    Args:
        audio_path: step_05ã§ç”Ÿæˆã—ãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
        script_content: step_04ã§ç”Ÿæˆã—ãŸå°æœ¬ï¼ˆæ­£ç¢ºãªãƒ†ã‚­ã‚¹ãƒˆç”¨ï¼‰
    
    Returns:
        Dict[str, Any]: å­—å¹•ãƒ‡ãƒ¼ã‚¿
        {
            "subtitles": [
                {
                    "start_time": float,    # ç§’
                    "end_time": float,      # ç§’
                    "text": str,           # è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
                    "speaker": str         # "A" or "B"
                },
                ...
            ],
            "total_count": int,
            "total_duration": float
        }
    
    ä½¿ç”¨å ´æ‰€: main.py step_06_generate_subtitles()
    ç›®æ¨™ç²¾åº¦: 95%ä»¥ä¸Š
    
    å‡¦ç†ãƒ•ãƒ­ãƒ¼:
        1. ElevenLabs STTã§éŸ³å£°â†’ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãï¼‰
        2. å…ƒã®å°æœ¬ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒãƒƒãƒãƒ³ã‚°ï¼ˆæ­£ç¢ºãªãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ç”¨ï¼‰
        3. ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— + æ­£ç¢ºãªãƒ†ã‚­ã‚¹ãƒˆã‚’çµ„ã¿åˆã‚ã›
    """
    try:
        from elevenlabs import transcribe
        
        # ElevenLabs STTã§æ–‡å­—èµ·ã“ã—
        with open(audio_path, "rb") as audio_file:
            transcription = transcribe(audio_file)
        
        # å…ƒã®å°æœ¬ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
        original_script = script_content.get("full_script", "")
        
        # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒãƒƒãƒãƒ³ã‚°
        subtitles = self._match_timestamps_with_script(
            transcription,
            original_script
        )
        
        subtitle_data = {
            "subtitles": subtitles,
            "total_count": len(subtitles),
            "total_duration": subtitles[-1]["end_time"] if subtitles else 0
        }
        
        logger.info(f"å­—å¹•ç”Ÿæˆå®Œäº†: {len(subtitles)}å€‹")
        return subtitle_data
    except Exception as e:
        logger.error(f"å­—å¹•ç”Ÿæˆã«å¤±æ•—: {e}")
        raise
```

---

### modules/video_generator.py

#### å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰1: generate_video_with_subtitles
```python
async def generate_video_with_subtitles(
    self,
    audio_path: str,
    subtitle_data: Dict[str, Any],
    script_content: Dict[str, Any]
) -> str:
    """
    å­—å¹•ä»˜ãå‹•ç”»ã‚’ç”Ÿæˆ
    
    Args:
        audio_path: step_05ã§ç”Ÿæˆã—ãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
        subtitle_data: step_06ã§ç”Ÿæˆã—ãŸå­—å¹•ãƒ‡ãƒ¼ã‚¿
        script_content: step_04ã§ç”Ÿæˆã—ãŸå°æœ¬ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç­‰ã«ä½¿ç”¨ï¼‰
    
    Returns:
        str: ç”Ÿæˆã•ã‚ŒãŸå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    
    ä½¿ç”¨å ´æ‰€: main.py step_07_generate_video()
    ç›®æ¨™æ™‚é–“: 3-5åˆ†
    
    å‹•ç”»ä»•æ§˜:
        - è§£åƒåº¦: 1920x1080 (Full HD)
        - FPS: 30
        - ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯: libx264, aac
    
    æ§‹æˆ:
        - èƒŒæ™¯ç”»åƒï¼ˆassets/background.pngï¼‰
        - éŸ³å£°
        - å­—å¹•ï¼ˆä¸‹éƒ¨ä¸­å¤®ã€Y=900ã€ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º40pxã€é»’èƒŒæ™¯70%é€éï¼‰
    """
    try:
        from moviepy.editor import (
            AudioFileClip, ImageClip, TextClip,
            CompositeVideoClip
        )
        
        # éŸ³å£°ã‚’èª­ã¿è¾¼ã¿
        audio_clip = AudioFileClip(audio_path)
        duration = audio_clip.duration
        
        # èƒŒæ™¯ç”»åƒã‚’èª­ã¿è¾¼ã¿
        background = ImageClip(
            self.settings.BACKGROUND_IMAGE_PATH,
            duration=duration
        ).resize((self.settings.VIDEO_WIDTH, self.settings.VIDEO_HEIGHT))
        
        # å­—å¹•ã‚¯ãƒªãƒƒãƒ—ã‚’ä½œæˆ
        subtitle_clips = []
        for sub in subtitle_data.get("subtitles", []):
            txt_clip = TextClip(
                sub["text"],
                fontsize=40,
                color="white",
                font=self.settings.FONT_PATH,
                method='caption',
                size=(self.settings.VIDEO_WIDTH - 100, None),
                bg_color='black@0.7'  # é»’èƒŒæ™¯ï¼ˆé€éåº¦70%ï¼‰
            ).set_position(('center', 900))  # Y=900
            
            txt_clip = txt_clip.set_start(sub["start_time"])
            txt_clip = txt_clip.set_duration(
                sub["end_time"] - sub["start_time"]
            )
            
            subtitle_clips.append(txt_clip)
        
        # å‹•ç”»ã‚’åˆæˆ
        video = CompositeVideoClip(
            [background] + subtitle_clips
        ).set_audio(audio_clip)
        
        # å‡ºåŠ›ãƒ‘ã‚¹
        output_path = f"{self.settings.OUTPUT_DIR}/video_{datetime.now().strftime('%Y%m%d_%H%M%S')}.mp4"
        
        # å‹•ç”»ã‚’å‡ºåŠ›
        video.write_videofile(
            output_path,
            fps=self.settings.VIDEO_FPS,
            codec='libx264',
            audio_codec='aac'
        )
        
        # ãƒªã‚½ãƒ¼ã‚¹ã‚’è§£æ”¾
        audio_clip.close()
        video.close()
        
        logger.info(f"å‹•ç”»ç”Ÿæˆå®Œäº†: {output_path}")
        return output_path
    except Exception as e:
        logger.error(f"å‹•ç”»ç”Ÿæˆã«å¤±æ•—: {e}")
        raise
```

#### å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰2: generate_thumbnail
```python
async def generate_thumbnail(self, metadata: Dict[str, Any]) -> str:
    """
    ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ç”Ÿæˆ
    
    Args:
        metadata: step_08ã§ç”Ÿæˆã—ãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç­‰ï¼‰
    
    Returns:
        str: ç”Ÿæˆã•ã‚ŒãŸã‚µãƒ ãƒã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    
    ä½¿ç”¨å ´æ‰€: main.py step_09_generate_thumbnail()
    
    ã‚µãƒ ãƒã‚¤ãƒ«ä»•æ§˜:
        - ã‚µã‚¤ã‚º: 1280x720ï¼ˆYouTubeã‚µãƒ ãƒã‚¤ãƒ«æ¨™æº–ï¼‰
        - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: PNG
        - èƒŒæ™¯: assets/background.pngã‚’ä½¿ç”¨
        - ãƒ†ã‚­ã‚¹ãƒˆ: ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤§ããè¡¨ç¤º
    """
    try:
        from PIL import Image, ImageDraw, ImageFont
        
        # èƒŒæ™¯ç”»åƒã‚’èª­ã¿è¾¼ã¿
        img = Image.open(self.settings.BACKGROUND_IMAGE_PATH)
        img = img.resize((1280, 720))
        
        # æç”»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        draw = ImageDraw.Draw(img)
        
        # ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿
        try:
            font = ImageFont.truetype(self.settings.FONT_PATH, 60)
        except:
            font = ImageFont.load_default()
        
        # ã‚¿ã‚¤ãƒˆãƒ«ã‚’æç”»
        title = metadata.get("title", "YouTube AI Podcast")
        
        # ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®ã«é…ç½®
        bbox = draw.textbbox((0, 0), title, font=font)
        text_width = bbox[2] - bbox[0]
        text_height = bbox[3] - bbox[1]
        x = (1280 - text_width) // 2
        y = (720 - text_height) // 2
        
        # èƒŒæ™¯ã‚’æç”»ï¼ˆèª­ã¿ã‚„ã™ãã™ã‚‹ï¼‰
        draw.rectangle(
            [(x-20, y-20), (x+text_width+20, y+text_height+20)],
            fill=(0, 0, 0, 180)
        )
        
        # ãƒ†ã‚­ã‚¹ãƒˆã‚’æç”»
        draw.text((x, y), title, font=font, fill="white")
        
        # ä¿å­˜
        output_path = f"{self.settings.OUTPUT_DIR}/thumbnail_{datetime.now().strftime('%Y%m%d_%H%M%S')}.png"
        img.save(output_path)
        
        logger.info(f"ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆå®Œäº†: {output_path}")
        return output_path
    except Exception as e:
        logger.error(f"ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã«å¤±æ•—: {e}")
        raise
```

---

## é‡è¦ãªæ³¨æ„äº‹é …

### 1. ãƒ¡ã‚½ãƒƒãƒ‰åã¯çµ¶å¯¾ã«å¤‰æ›´ã—ãªã„
ä¸Šè¨˜ã®ãƒ¡ã‚½ãƒƒãƒ‰åã¨ã‚·ã‚°ãƒãƒãƒ£ã¯ã€`main.py`ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã€**çµ¶å¯¾ã«å¤‰æ›´ã—ãªã„ã§ãã ã•ã„**ã€‚

### 2. æˆ»ã‚Šå€¤ã®å‹ã‚’å®ˆã‚‹
å„ãƒ¡ã‚½ãƒƒãƒ‰ã®æˆ»ã‚Šå€¤ã®å‹ï¼ˆDict, str, Noneç­‰ï¼‰ã¯ã€å‘¼ã³å‡ºã—å…ƒã§ä½¿ç”¨ã•ã‚Œã‚‹ãŸã‚ã€**å¿…ãšå®ˆã£ã¦ãã ã•ã„**ã€‚

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯å¿…é ˆ
ã™ã¹ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§`try-except`ã‚’å®Ÿè£…ã—ã€ã‚¨ãƒ©ãƒ¼æ™‚ã¯è©³ç´°ã‚’ãƒ­ã‚°å‡ºåŠ›ã—ã¦ã‹ã‚‰`raise`ã—ã¦ãã ã•ã„ã€‚

### 4. ãƒ­ã‚°å‡ºåŠ›ã¯å¿…é ˆ
å‡¦ç†ã®é–‹å§‹ãƒ»å®Œäº†æ™‚ã«å¿…ãšãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚çµµæ–‡å­—ã‚’ä½¿ç”¨ã™ã‚‹ã¨è¦–èªæ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

### 5. éåŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ã¯`async def`
ã™ã¹ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯`async def`ã§å®šç¾©ã—ã¦ãã ã•ã„ã€‚

## å®Ÿè£…ã®ç¢ºèªæ–¹æ³•

å„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å˜ä½“ãƒ†ã‚¹ãƒˆã§ç¢ºèªã§ãã¾ã™ï¼š

```python
async def test_method():
    settings = Settings()
    manager = ModuleName(settings)
    result = await manager.method_name(args)
    print(result)

# å®Ÿè¡Œ
import asyncio
asyncio.run(test_method())
```
